{% extends "TheaterWinBook/base_header_footer.html" %}
{% load static %}
{% block css_script %}
    <style>
        .breadcrumb-wrap {
            padding: 5%;
        }
    </style>
    <!-- demo stylesheet -->
    <link type="text/css" rel="stylesheet" href="{% static 'TheaterWinBook/daypilot/helpers/demo.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'TheaterWinBook/daypilot/helpers/media/layout.css' %}"
          href="../helpers/"/>
    <link type="text/css" rel="stylesheet" href="{% static 'TheaterWinBook/daypilot/helpers/demo.css' %}"
          href="../helpers/media/elements.css?v=2018.2.232"/>

    <!-- helper libraries -->
    <script src="{% static 'TheaterWinBook/daypilot/helpers/jquery-1.9.1.min.js' %}"></script>

    <!-- daypilot libraries -->
    <script src="{% static 'TheaterWinBook/daypilot/js/daypilot-all.min.js' %}" type="text/javascript"></script>

    <!-- daypilot themes -->
    <link type="text/css" rel="stylesheet" href="{% static 'TheaterWinBook/daypilot/themes/month_white.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'TheaterWinBook/daypilot/themes/month_green.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'TheaterWinBook/daypilot/themes/month_transparent.css' %}"/>

    <link type="text/css" rel="stylesheet"
          href="{% static 'TheaterWinBook/daypilot/themes/calendar_transparent.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'TheaterWinBook/daypilot/themes/calendar_white.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'TheaterWinBook/daypilot/themes/calendar_green.css' %}"/>

    <link type="text/css" rel="stylesheet" href="{% static 'TheaterWinBook/daypilot/themes/navigator_green.css' %}"/>
    <link type="text/css" rel="stylesheet" href="{% static 'TheaterWinBook/daypilot/themes/navigator_white.css' %}"/>
{% endblock %}

{% block content %}
        {{ winbook_user_result_json }}

    <div id="container">
        <div id="content" style="margin: 0px 1%">

            <div>
                <div class="space">
                    <a href="javascript:dp.startDate = dp.startDate.addMonths(-1); dp.update();">Previous</a>
                    |
                    <a href="javascript:dp.startDate = dp.startDate.addMonths(1); dp.update();">Next</a>
                </div>

                <div id="dp"></div>


                <!-- bottom -->
            </div>
        </div>
    </div>
    <div class="divide40"></div>
    </div>


{% endblock %}

{% block javascript %}


    <script type="text/javascript">
        {#    오늘 날짜 구해서 달력에 표시하기 #}
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; //January is 0!
        var yyyy = today.getFullYear();
        if (dd < 10) {
            dd = '0' + dd
        }
        if (mm < 10) {
            mm = '0' + mm
        }
        today = yyyy + '-' + mm + '-' + dd;
        var dp = new DayPilot.Month("dp");
        // view
        dp.startDate = today;  // or just dp.startDate = "2013-03-25";


        {% comment %}
               // 달력 클릭 시 이벤트 삽입은 나중에
              // event creating
              dp.onTimeRangeSelected = function (args) {
                  var name = prompt("New event name:", "Event");
                  dp.clearSelection();
                  if (!name) return;
                  var e = new DayPilot.Event({
                      start: args.start,
                      end: args.end,
                      id: DayPilot.guid(),
                      text: name
                  });
                  alert("this is add button");
                  dp.events.add(e);
              };
              {% endcomment %}

        dp.onEventClicked = function (args) {
            alert("clicked: " + args.e.id());
            alert("this is event button");
        };
        dp.init();
    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            var url = window.location.href;
            var filename = url.substring(url.lastIndexOf('/') + 1);
            if (filename === "") filename = "index.html";
            $(".menu a[href='" + filename + "']").addClass("selected");

            // 모든 정보 불러오기
            var winbook_user_result_json = '{{ winbook_user_result_json|escapejs|safe  }}';
            var winbook_user_result_json_parsed = $.parseJSON(winbook_user_result_json);
            for (var i = 0; i < winbook_user_result_json_parsed.length; ++i) {
                var record_buy_date = JSON.stringify(winbook_user_result_json_parsed[i].fields.buy_date);
                var duration = 0;
                var start = 0;
                {#record_buy_date의 날짜에 "2018-08-01"형식으로 되어 있어서, 위의 따옴표를 없애준다. #}
                var regExp = /[\{\}\[\]\/?.,;:|\)*~`!^_+<>@\#$%&\\\=\(\'\"]/gi;
                    record_buy_date= record_buy_date.replace(regExp, "");
                var e = new DayPilot.Event({
                    start: new DayPilot.Date(record_buy_date).addDays(start),
                    end: new DayPilot.Date(record_buy_date).addDays(start).addDays(duration),
                    {#end: new DayPilot.Date("2013-03-04T12:00:00").addDays(start).addDays(duration),#}
                    id: "startday" + start,
                    text: "Event " + i
                });
                dp.events.add(e);

            }


        });

    </script>

{% endblock %}


